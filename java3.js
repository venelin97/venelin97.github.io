const eventsData = { 
  Ant: [ 
    {title:"Държавност и културно наследство на траките ", text:"Траките са били един от най-многобройните народи в античността, разделени на над 80 племена. Те не са оставили писменост, но тяхното богатство и духовност личат в уникалните гробници и златни съкровища като Панагюрското. Тракийските конници са били легендарни, а вярванията им в безсмъртието на душата са вдъхновили митове за герои като Орфей. Одриското царство е първият им опит да обединят тези племена в мощна държава, която е съперничила дори на Атина.", image:"images/traki.jpg"}, 
    {title:"Гръцката колонизация по Черноморието", text:"Черно море, наричано от гърците Понтос Еуксейнос (Гостоприемно море), става сцена на мащабна колонизация. Одесос (Варна) и Месемврия (Несебър) не са били просто градове, а живи мостове между елинската култура и вътрешността на Тракия. Тук са се обменяли фини гръцки вина и керамика срещу тракийско зърно, метали и кожи. Месемврия дори е секла свои собствени златни монети, което доказва огромната икономическа мощ на тези пристанища.", image:"images/Odesos.jpg"}, 
    {title:"Елинистическа експанзия", text:"През 342 г. пр. Хр. македонският владетел Филип II, бащата на Александър Велики, предприема мащабен поход в Тракия. Той завладява стратегическото тракийско селище Еумолпия и го превръща в укрепен град, наречен на негово име – Филипопол (днешен Пловдив). Градът е разположен на три хълма и бързо се превръща в най-важния икономически и административен център на антична Тракия. Това поставя началото на дълбоко елинистическо влияние върху местната аристокрация, култура и бит.", image:"images/filip.jpg"}, 
    {title:"Устройство под римска власт", text:"Рим не просто завладява Тракия, той я преобразява. След 46 г. сл. Хр. по нашите земи се издигат градове със сложна канализация, амфитеатри и терми (бани). Римляните изграждат 'магистралите' на античността – Via Militaris и Via Pontica, които свързват Рим с Константинопол. Сердика (днешна София) става толкова важна, че император Константин Велики често е казвал: 'Сердика е моят Рим!'. Дори днес, разхождайки се в центъра на София, стъпваме върху плочите на този древен град.", image:"images/okupacia.jpg"}, 
    {title:"Разпространение на християнството", text:"Разпространение на римска култура, латински език и християнство в някои региони.", image:"images/trakiizkustvo.jpg"} 
  ], 
  Sredn: [
    {title:"Създаване на Първото българско царство", text:"През 681 г. византийският император Константин IV е принуден да подпише мирен договор и да плаща данък на един нов и непознат народ. Това е официалното признание на България. Хан Аспарух избира Плиска за столица – огромен град, заобиколен от земни валове и каменни стени, който е заемал площ от 23 кв. км (по-голям от тогавашния Константинопол). Българите донасят със себе си държавна организация, която съчетава войнствеността на прабългарите с уседналия начин на живот на славяните.", image:"images/1vo bg charstvo.jpg"}, 
    {title:"Съперничество между България и Византия", text:"Отношенията между България и Източната римска империя (Византия) са низ от военни конфликти и периоди на културен обмен. От кан Тервел, който спасява Константинопол от арабите, до кан Крум, който влиза в пряк двубой с император Никифор, борбата е за надмощие на Балканите. Византия не приема лесно присъствието на независима държава на своите граници, но именно в тези войни се калява българската народност. Този период завършва с падането на Първото царство, но и с трайното възприемане на православието и византийския държавен модел.", image:"images/bitkisvisantiq.jpg"}, 
    {title:"Златен век на България", text:"При цар Симеон Велики България не е просто военна сила, тя е културен хегемон. След като приема християнството при Борис I, страната се нуждае от собствена писменост. Симеон превръща новата столица Велики Преслав в 'преславен' град с бели каменни стени и позлатени куполи. Тук работят книжовници, които превеждат най-важните християнски текстове на старобългарски език, превръщайки България в духовен фар за всички славянски народи. Това е времето на 'Три морета' – България се мие от водите на Черно, Егейско и Адриатическо море.", image:"images/zlatenvek.jpg"}, 
    {title:"Залез на Първата българска държава", text:"Краят на Първото царство е изпълнен с драматизъм и героизъм. Цар Самуил води епична съпротива срещу византийския император Василий II, наречен по-късно 'Българоубиец'. В продължение на десетилетия двете империи са в състояние на перманентна война. Трагедията след битката при Беласица (1014 г.), където 15 000 български войници са ослепени, пречупва сърцето на царя, но не и духа на народа. През 1018 г. България пада под византийска власт, но съхранява своята култура и църква, което помага за бъдещото ѝ възкресение.", image:"images/padane.jpg"} 
  ], 
  Vazr: [ 
    {title:"Национално възраждане", text:"След векове на застой, през 1762 г. един монах в Атонския манастир написва книга, която променя всичко. Паисий Хилендарски се обръща към народа си с думите: 'О, неразумни и юроде! Поради що се срамиш да се наречеш българин?'. Неговата 'История славянобългарска' е искрата, която разпалва националното самосъзнание. Започва епоха на бурно строителство на църкви и училища. Българите започват сами да финансират образованието си, изпращайки децата си да учат в Русия, Франция и Австрия, подготвяйки се за своята свобода.", image:"images/paisiy.jpg"}, 
    {title:"Българската борба за независимост", text:"Васил Левски, наричан Апостола на свободата, прави нещо революционно за времето си – той създава 'държава в държавата'. Неговата тайна комитетска мрежа обхваща всяко село и град, подготвяйки народа за мига, в който ще 'въскръсне България'. Заедно с пламенния поет Христо Ботев, те задават идеала за 'чиста и свята република'. Априлското въстание от 1876 г., макар и удавено в кръв, постига своята политическа цел – светът научава за българската кауза и принуждава Великите сили да се намесят.", image:"images/levski.jpg"}, 
    {title:"Руско-турската война", text:"Руско-турската война от 1877–1878 г. е кулминацията на българския национален въпрос. След Априлското въстание, което разтърсва Европа, руският император Александър II обявява война на Османската империя. Епичните боеве при Шипка, където българските опълченци проявяват нечуван героизъм, и обсадата на Плевен предрешават изхода на конфликта. На 3 март 1878 г. в Сан Стефано е подписан договор, който след близо пет века полага основите на Третата българска държава.", image:"images/ruskoturska.jpg"}, 
    {title:"Учредяване на Княжество България", text:"След Освобождението, в старопрестолния град Търново се свиква Учредителното събрание (1879 г.). Неговата задача е да създаде Търновската конституция – един от най-либералните и демократични закони в тогавашна Европа. България се превръща в конституционна монархия с парламент. Първият избран владетел е Александър I Батенберг. Това е време на изграждане на държавни институции, съдебна система и редовна армия, които трябва да превърнат младото княжество в модерна европейска сила.", image:"images/uchrezdavane.jpg"}, 
    {title:"Развитие на светското новобългарско образование", text:"Възраждането на българския дух започва от класната стая. Движението за новобългарско образование заменя килийните училища със светски девически и мъжки гимназии. Васил Априлов основава първото взаимно училище в Габрово през 1835 г. След 1878 г. държавата поема образованието под свое крило, въвеждайки задължително обучение. Този период бележи превръщането на неграмотния народ в нация с интелигенция, способна да управлява държавните дела и да развива науката и изкуството.", image:"images/uchiliste.jpg"} 
  ], 
  NovoVr: [ 
    {title:"Обявяване независимостта на Царство България", text:"Три десетилетия след Освобождението, България все още е васално княжество на Османската империя по документи. На 22 септември 1908 г. в старата столица Велико Търново, княз Фердинанд прочита Манифеста за независимостта. Това не е просто символичен акт – с него България става равноправна на другите европейски държави, спира да плаща годишен данък на султана и получава правото на собствена външна политика. Този ден показва, че българската дипломация е пораснала и може да печели битки без нито един изстрел.", image:"images/nezavisimost.jpg"}, 
    {title:"България в Първата световна война", text:"През 1915 г. България влиза в Голямата война на страната на Централните сили (Германия, Австро-Унгария и Турция). Основният стремеж е обединението на разпокъсаните български земи в Македония и Тракия. Българската армия постига невероятни победи на Добруджанския и Македонския фронт, демонстрирайки висока бойна ефективност. Въпреки това, поражението на съюзниците води до Ньойския договор – втората национална катастрофа, която лишава страната от излаз на Бяло море и откъсва важни територии.", image:"images/1svetovna.jpg"}, 
    {title:"България във Втората световна война", text:"По време на глобалния конфликт (1939–1945), България се опитва да запази неутралитет, но през 1941 г. е принудена да се присъедини към Тристранния пакт. Въпреки натиска от нацистка Германия, цар Борис III и българското гражданско общество отказват да изпратят войски на Източния фронт срещу Русия и успяват да спасят близо 50 000 български евреи от депортация. Войната за България завършва с навлизането на съветските войски на 8 септември 1944 г. и радикална смяна на политическата система.", image:"images/2rasvetovna.jpg"}, 
    {title:"Социалистическа държава", text:"След 1944 г. България е обявена за Народна република и попада в сферата на влияние на СССР. През следващите 45 години се установява еднопартийна система начело с Българската комунистическа партия. Страната преминава през насилствена колективизация на земята и мащабна индустриализация. Построени са нови градове, заводи и язовири. Въпреки социалните придобивки и липсата на безработица, периодът е белязан от политически репресии, липса на свобода на словото и желязна завеса пред останалия свят.", image:"images/todor.jpg"}, 
    {title:"Демократични промени", text:"Падането на Берлинската стена през 1989 г. отекна и в България. На 10 ноември Тодор Живков е свален от власт след 35-годишно управление. Започва трудният път на прехода – от планова икономика към пазарна и от тоталитаризъм към демокрация. Тези години са изпълнени с надежди, митинги и икономически трудности. Но усилията се отплащат: през 2004 г. България става част от НАТО, а през 2007 г. се завръща в европейското семейство като член на ЕС, което отваря границите за пътуване, работа и образование в цяла Европа.", image:"images/es.jpg"} 
  ] 
};

const extraQuestions = [
  { q: "Какво представляват тракийските племена?", correct: "Те са над 80 племена с богата култура и духовност, без писменост.", options: ["Те са над 80 племена с богата култура и духовност, без писменост.", "Те са малка група хора със семпла икономика и писменост.", "Те са подчинени на гърците и нямат свои традиции."] },
  { q: "Какво е Панагюрското съкровище?", correct: "Златно тракийско съкровище, доказващо богатството и изкуството на траките.", options: ["Златно тракийско съкровище, доказващо богатството и изкуството на траките.", "Малко сребърно украшение с религиозно значение.", "Монета от елинистическо време без връзка с траките."] },
  { q: "Какви вярвания имали траките за душата?", correct: "Вярвали в безсмъртието на душата и героични митове като Орфей.", options: ["Вярвали в безсмъртието на душата и героични митове като Орфей.", "Не вярвали в живот след смъртта и не разказвали митове.", "Следвали само гърците и техните религиозни практики."] },
  { q: "Какво представлява Одриското царство?", correct: "Първата тракийска държава, обединяваща племената с централизирана власт.", options: ["Първата тракийска държава, обединяваща племената с централизирана власт.", "Малка област без значимо влияние в Тракия.", "Гръцка колония с ограничена автономия."] },
  { q: "Какво представляват Одесос и Месемврия?", correct: "Гръцки колонии по Черноморието, важни за търговия и култура.", options: ["Гръцки колонии по Черноморието, важни за търговия и култура.", "Малки селища без икономическа роля.", "Основни военни лагери на траките."] },
  { q: "Каква е икономическата роля на Месемврия?", correct: "Пристанищен град, сечащ собствени монети и търгуващ със зърно и кожи.", options: ["Пристанищен град, сечащ собствени монети и търгуващ със зърно и кожи.", "Малко селище без търговия и производство на монети.", "Религиозен център без икономическо значение."] },
  { q: "Какво прави Филип II в Тракия?", correct: "Завладява Еумолпия и основава Филипопол с елинистическо влияние.", options: ["Завладява Еумолпия и основава Филипопол с елинистическо влияние.", "Преминава без да оставя следи.", "Разрушава всички тракийски селища без основаване на нови."] },
  { q: "Какво представляват Via Militaris и Via Pontica?", correct: "Римски пътища, свързващи Рим с Константинопол за търговия и войски.", options: ["Римски пътища, свързващи Рим с Константинопол за търговия и войски.", "Малки локални пътища без значение.", "Религиозни пътеки за поклонници."] },
  { q: "Какво прави Сердика под римляните?", correct: "Става важен административен и икономически център, наречен 'мой Рим'.", options: ["Става важен административен и икономически център, наречен 'мой Рим'.", "Остава малко селище без значение.", "Разрушена и неразвита под римска власт."] },
  { q: "Какво прави цар Борис I за културата?", correct: "Приема християнството и въвежда нова писменост за превод на религиозни текстове.", options: ["Приема християнството и въвежда нова писменост за превод на религиозни текстове.", "Пренебрегва християнството и оставя страната без писменост.", "Приема християнството, но не насърчава културата."] },
  { q: "Какво е значението на 'Три морета'?", correct: "България се простира до Черно, Егейско и Адриатическо море като културен и военен хегемон.", options: ["България се простира до Черно, Егейско и Адриатическо море като културен и военен хегемон.", "Поетичен израз без географско значение.", "Митична концепция без реални граници."] },
  { q: "Какво е значението на Аспарухова Плиска?", correct: "Столицата на Първото българско царство, обединяваща славяни и прабългари.", options: ["Столицата на Първото българско царство, обединяваща славяни и прабългари.", "Малък град без политическо значение.", "Гръцка колония с ограничена власт."] },
  { q: "Какво постига кан Тервел?", correct: "Спасява Константинопол от арабите и укрепва българската държавност.", options: ["Спасява Константинопол от арабите и укрепва българската държавност.", "Отстъпва на арабите и губи територии.", "Подчинява се на Византия без съпротива."] },
  { q: "Какво прави кан Крум?", correct: "Побеждава византийския император Никифор и разширява територията на България.", options: ["Побеждава византийския император Никифор и разширява територията на България.", "Сключва мир без военни действия.", "Подчинява се на Византия без съпротива."] },
  { q: "Какво се случва при цар Самуил?", correct: "Водят епична съпротива срещу Василий II с трайни последици за народа.", options: ["Водят епична съпротива срещу Василий II с трайни последици за народа.", "Губят битките и изчезват като народ.", "Сключват мир без загуби."] },
  { q: "Какво е Априлското въстание?", correct: "Опит за освобождение от Османската империя, привлича вниманието на Европа.", options: ["Опит за освобождение от Османската империя, привлича вниманието на Европа.", "Малка локална акция без международен ефект.", "Религиозно събитие, свързано с църкви."] },
  { q: "Какво прави Васил Левски?", correct: "Създава тайна комитетска мрежа за подготовка на национално освобождение.", options: ["Създава тайна комитетска мрежа за подготовка на национално освобождение.", "Води малка армия без влияние.", "Работи само с чужди дипломати."] },
  { q: "Какво правят българските опълченци при Шипка?", correct: "Проявяват героизъм и задържат позиции, подпомагайки освобождението.", options: ["Проявяват героизъм и задържат позиции, подпомагайки освобождението.", "Оттеглят се и оставят региона на османците.", "Не участват в бойните действия."] },
  { q: "Какво представлява движението за новобългарско образование?", correct: "Замества килийните училища със светски гимназии и развива интелигенцията.", options: ["Замества килийните училища със светски гимназии и развива интелигенцията.", "Поддържа религиозни училища без промяна.", "Изпраща учениците само в чужбина."] },
  { q: "Какво е значението на Сан Стефано?", correct: "Договорът полага основите на Третата българска държава след Освобождението.", options: ["Договорът полага основите на Третата българска държава след Освобождението.", "Местен документ без значение за държавността.", "Религиозен пакт между манастири."] },
  { q: "Кой е първият княз на Княжество България?", correct: "Александър I Батенберг, избран след Учредителното събрание през 1879 г.", options: ["Александър I Батенберг, избран след Учредителното събрание през 1879 г.", "Фердинанд I без избори.", "Князът на Видин без власт в Търново."] },
  { q: "Какво постига Учредителното събрание?", correct: "Приема Търновската конституция и създава конституционна монархия.", options: ["Приема Търновската конституция и създава конституционна монархия.", "Отхвърля всякакви закони и оставя страната без ред.", "Създава малка локална администрация без конституция."] },
  { q: "Какво се случва на 22 септември 1908 г.?", correct: "Обявява се независимостта на България с Манифеста във Велико Търново.", options: ["Обявява се независимостта на България с Манифеста във Велико Търново.", "Започва Първата световна война.", "Сключва се съюз с Османската империя."] },
  { q: "Какво прави България през Първата световна война?", correct: "Влиза на страната на Централните сили за обединение на българските земи.", options: ["Влиза на страната на Централните сили за обединение на българските земи.", "Запазва неутралитет през целия конфликт.", "Присъединява се към Антантата за източни територии."] },
  { q: "Какво се случва с Южна Добруджа през 1940 г.?", correct: "Връща се на България с подписването на Крайовската спогодба.", options: ["Връща се на България с подписването на Крайовската спогодба.", "Остава под румънска власт без промяна.", "Присъединява се към Турция след война."] },
  { q: "Какво прави България във Втората световна война?", correct: "Опитва неутралитет, присъединява се към Тристранния пакт и спасява еврейското население.", options: ["Опитва неутралитет, присъединява се към Тристранния пакт и спасява еврейското население.", "Води активна война на Източния фронт срещу Русия.", "Подчинява се напълно на Германия без протекция за населението."] },
  { q: "Какво е социалистическа България?", correct: "Народна република с еднопартийна система, индустриализация и колективизация.", options: ["Народна република с еднопартийна система, индустриализация и колективизация.", "Малка демокрация с пазарна икономика.", "Конституционна монархия със свободни избори."] },
  { q: "Какво се случва на 10 ноември 1989 г.?", correct: "Свалят Тодор Живков и започва преход към демокрация и пазарна икономика.", options: ["Свалят Тодор Живков и започва преход към демокрация и пазарна икономика.", "Начало на Втората световна война.", "Започва социалистическа модернизация без промени."] },
  { q: "Кога България влиза в НАТО?", correct: "През 2004 г. България става член на НАТО и укрепва международната си позиция.", options: ["През 2004 г. България става член на НАТО и укрепва международната си позиция.", "През 2007 г. влиза в ЕС, но не в НАТО.", "През 1989 г. без международно значение."] },
  { q: "Кога България става член на ЕС?", correct: "През 2007 г. България се присъединява към Европейския съюз и отваря границите.", options: ["През 2007 г. България се присъединява към Европейския съюз и отваря границите.", "През 2004 г. става член на ЕС.", "През 2010 г. присъединяването е формално, без ползи."] },
  { q: "Кой град е основан като Филипопол?", correct: "Днешният Пловдив, важен център за елинистическа култура.", options: ["Днешният Пловдив, важен център за елинистическа култура.", "София, административен център на Рим.", "Варна, древна гърцка колония."] },
  { q: "Кой е последният владетел на Първото българско царство?", correct: "Цар Самуил, водил съпротива срещу византийците до 1018 г.", options: ["Цар Самуил, водил съпротива срещу византийците до 1018 г.", "Цар Петър, без военни успехи.", "Цар Иван Владислав, без влияние върху държавата."] },
  { q: "Кой е основният идеолог на комитетската мрежа?", correct: "Васил Левски, Апостолът на свободата и организатор на революционната мрежа.", options: ["Васил Левски, Апостолът на свободата и организатор на революционната мрежа.", "Христо Ботев, само поет и журналист.", "Георги Раковски, без практическа организация."] },
  { q: "Коя книга поставя началото на Възраждането?", correct: "История славянобългарска на Паисий Хилендарски от 1762 г.", options: ["История славянобългарска на Паисий Хилендарски от 1762 г.", "Рибен буквар, използван за обучение.", "Горски пътник, популярна художествена творба."] },
  { q: "Какво се случва при битката при Беласица?", correct: "15 000 български войници са ослепени, пречупва царя но не народа.", options: ["15 000 български войници са ослепени, пречупва царя но не народа.", "Българите побеждават и разширяват територията си.", "Войниците са депортирани без последствия."] },
  { q: "Кое събитие бележи края на Първото българско царство?", correct: "Византийската победа през 1018 г. и падането на царството.", options: ["Византийската победа през 1018 г. и падането на царството.", "Смъртта на хан Крум без последици.", "Присъединяването към Османската империя без битки."] },
  { q: "Какво представлява Златният век на България?", correct: "Цар Симеон превръща Преслав в културен център и духовен фар за славяните.", options: ["Цар Симеон превръща Преслав в културен център и духовен фар за славяните.", "Период без културно развитие.", "Гръцки колонии доминират над България."] },
  { q: "Как се разпространява християнството в Тракия?", correct: "С римската култура, латинския език и първите християнски общини.", options: ["С римската култура, латинския език и първите християнски общини.", "Само чрез гръцки монаси без латинско влияние.", "Не се разпространява и остава езическо."] },
  { q: "Какво постига руско-турската война за България?", correct: "Освобождение и основи на Третата българска държава чрез Сан Стефано.", options: ["Освобождение и основи на Третата българска държава чрез Сан Стефано.", "Малък локален успех без значение за държавата.", "Територии остават под Османската империя."] },
  { q: "Кога е написана История славянобългарска?", correct: "През 1762 г. от Паисий Хилендарски в Атонския манастир.", options: ["През 1762 г. от Паисий Хилендарски в Атонския манастир.", "През 1800 г. от неизвестен автор.", "През 1700 г. от гръцки монах."] }
];


let currentEpoch = ""; 
let currentQuizSelection = []; 

function checkQuiz() {
  currentQuizSelection.forEach((q, i) => {
    const options = document.getElementsByName(`q${i}`);
    options.forEach(opt => {
      const icon = opt.nextElementSibling.nextElementSibling; 
      if (opt.checked) {
        if (opt.value === q.correct) {
          icon.textContent = "✔"; 
          icon.style.color = "green";
        } else {
          icon.textContent = "✖";
          icon.style.color = "red";
        }
      } else if (opt.value === q.correct) {
        icon.textContent = "✔";
        icon.style.color = "green";
      }
      showQuizResult();
    });
  });
}
function showQuizResult() {
  let score = 0;

  currentQuizSelection.forEach((q, i) => {
    const options = document.getElementsByName(`q${i}`);
    options.forEach(opt => {
      if (opt.checked && opt.value === q.correct) score++;
    });
  });

  document.getElementById("quiz-score").innerHTML =
    `${score} / ${currentQuizSelection.length}`;

  document.getElementById("quiz-result-overlay").style.display = "flex";
  document.body.style.overflow = "hidden";
}

function closeQuizResult() {
  document.getElementById("quiz-result-overlay").style.display = "none";
  document.body.style.overflow = "auto";
}



window.addEventListener("scroll", () => {
  const btn = document.getElementById("scrollToTop");
  if (window.scrollY > 300) {
    btn.classList.add("show");
  } else {
    btn.classList.remove("show");
  }
});


function scrollToTop() {
  window.scrollTo({ top: 0, behavior: "smooth" });
}


function showSection(id) { 
  document.querySelectorAll('.section').forEach(s => { s.classList.remove('active'); }); 
  document.getElementById(id).classList.add('active'); 
  window.scrollTo({ top: 0, behavior: 'smooth' }); 
} 

/* ===== ЕПОХИ ===== */ 
function showEpoch(epoch) { 
  currentEpoch = epoch; 
  document.querySelectorAll('#timeline button').forEach(btn => { btn.classList.toggle('active-epoch', btn.dataset.epoch === epoch); }); 
  const container = document.getElementById("events"); 
  container.innerHTML = ""; 
  if (!eventsData[epoch]) return; 
  eventsData[epoch].forEach(ev => { 
    const btn = document.createElement("button"); 
    btn.textContent = ev.title; 
    btn.onclick = () => openOverlay(ev); 
    container.appendChild(btn); 
  }); 
} 

/* ===== OVERLAY ===== */ 
function openOverlay(ev) { 
  document.body.style.overflow = "hidden";
  document.getElementById("event-title").textContent = ev.title; 
  document.getElementById("event-text").textContent = ev.text; 
  document.getElementById("event-img").src = ev.image; 
  document.getElementById("event-overlay").style.display = "flex"; 
} 
function closeOverlay() { 
  document.body.style.overflow = "auto";
  document.getElementById("event-overlay").style.display = "none"; 
} 

const input = document.getElementById("focusInput");
const textBox = document.getElementById("focusText");
const practiceBtn = document.getElementById("focusPractice");
const questionBox = document.getElementById("question-container");
const title = document.getElementById("focusTitle");

input.addEventListener("keydown", function (e) {
  if (e.key !== "Enter") return;
  const topic = input.value.trim().toLowerCase();
  if (!topic) return;
  let foundEvent = null;
  for (const epoch in eventsData) {
    for (const ev of eventsData[epoch]) {
      if (ev.title.toLowerCase().includes(topic)) {
        foundEvent = ev;
        break;
      }
    }
    if (foundEvent) break;
  }
  if (!foundEvent) {
    title.textContent = "Няма намерена тема";
    title.style.color = "darkred";
    textBox.classList.add("hidden");
    practiceBtn.classList.add("hidden");
    return;
  }
  focusTopic = topic; 
  title.textContent = foundEvent.title;
  title.style.color = "#1e3ea0";
  textBox.textContent = foundEvent.text;
  textBox.classList.remove("hidden");
  practiceBtn.classList.remove("hidden");
});


practiceBtn.addEventListener("click", function () {
  showSection("quiz");
  generateQuiz();
});


document.getElementById("focus-button").onclick = async () => {
  const topic = document.getElementById("topic-input").value;
  if (!topic) return alert("Моля, въведете тема!")
  const container = document.getElementById("questions-container");
  container.innerHTML = "<p>Зареждане на допълнителна информация...</p>";
  try {
    const aiInfo = await fetch("https://my-ai-server.onrender.com/get-ai-info", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ topic })
    }).then(res => res.json());
    container.innerHTML = `<div class="ai-text-box">${aiInfo.text}</div>`;
    generateQuizFromText(aiInfo.text);
  } catch (err) {
    console.error(err);
    container.innerHTML = "<p>Възникна грешка при AI заявката.</p>";
  }
};
function generateQuizFromText(text) {
  const sentences = text.match(/[^.?!]+[.?!]/g) || [];
  const questions = sentences.map((s, i) => ({
    q: `${i+1}. Какво се казва в текста?`,
    options: [
      s,
      "Това противоречи на текста",
      "Не е споменато"
    ]
  }));
  currentQuizSelection = questions;
  renderQuiz();
}


/* ===== QUIZ ===== */ 
function generateQuiz() {
  let sourceQuestions = extraQuestions;
  if (focusTopic) {
    sourceQuestions = extraQuestions.filter(q =>
      q.topic && q.topic.toLowerCase().includes(focusTopic)
    );
  }
  const container = document.getElementById("questions-container");
  container.innerHTML = "";
  if (!sourceQuestions.length) {
    container.innerHTML = `
      <p style="color:#b00020; font-weight:600;">
        Няма налични въпроси по тази тема.
      </p>
    `;
    document.getElementById("check-button").style.display = "none";
    focusTopic = null;
    return;
  }
  currentQuizSelection = shuffle(sourceQuestions).slice(0, 10);
  renderQuiz();
  document.getElementById("check-button").style.display = "block";
  focusTopic = null;
}
function shuffleCurrentQuiz() { 
  if (!currentQuizSelection.length) return; 
  currentQuizSelection = shuffle(currentQuizSelection); 
  renderQuiz(); 
} 
function shuffle(arr) { 
  return [...arr].sort(() => Math.random() - 0.5); 
} 
function renderQuiz() {
  const container = document.getElementById("questions-container");
  container.innerHTML = "";

  currentQuizSelection.forEach((q, i) => {
    const box = document.createElement("div");
    box.className = "quiz-question-box";

    let html = `<p>${i + 1}. ${q.q}</p>`;

    shuffle(q.options).forEach(opt => {
      html += `
        <div class="answer-option">
          <input type="radio" name="q${i}" value="${opt}">
          <label>${opt}</label>
          <span class="status-icon"></span>
        </div>
      `;
    });

    box.innerHTML = html;
    container.appendChild(box);

    box.querySelectorAll(".answer-option").forEach(option => {
      option.onclick = function () {
        const radio = option.querySelector("input");
        radio.checked = true;
        box.querySelectorAll(".answer-option").forEach(o => o.classList.remove("selected"));
        option.classList.add("selected");
      };
    });
  });
}




